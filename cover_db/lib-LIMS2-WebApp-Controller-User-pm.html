<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.92
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: lib/LIMS2/WebApp/Controller/User.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">lib/LIMS2/WebApp/Controller/User.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">62.2%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td class="s">package LIMS2::WebApp::Controller::User;</td></tr>
<tr><td class="h">2</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L2">2</a></div></td><td class="s">use Moose;</td></tr>
<tr><td class="h">3</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L3">2</a></div></td><td class="s">use namespace::autoclean;</td></tr>
<tr><td class="h">4</td><td colspan="5"></td></tr><tr><td class="h">5</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L5">2</a></div></td><td class="s">BEGIN {extends &#39;Catalyst::Controller&#39;; }</td></tr>
<tr><td class="h">6</td><td colspan="5"></td></tr><tr><td class="h">7 - 17</td><td colspan="4"></td><td class="s"><pre>=head1 NAME

LIMS2::WebApp::Controller::User - Catalyst Controller

=head1 DESCRIPTION

Catalyst Controller.

=head1 METHODS

=cut</pre></td></tr>
<tr><td class="h">18</td><td colspan="5"></td></tr><tr><td class="h">19</td><td></td><td></td><td></td><td></td><td class="s">sub auto : Private {</td></tr>
<tr><td class="h">20</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L20">1</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $c ) = @_;</td></tr>
<tr><td class="h">21</td><td colspan="5"></td></tr><tr><td class="h">22</td><td><div class="c3">1</div></td><td><div class="c0" title="-/-"><a href="lib-LIMS2-WebApp-Controller-User-pm--branch.html#L22">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ! $c-&gt;user_exists ) {</td></tr>
<tr><td class="h">23</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;stash( error_msg =&gt; &#39;Please login to access this system&#39; );</td></tr>
<tr><td class="h">24</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;stash( goto_on_success =&gt; $c-&gt;request-&gt;uri );</td></tr>
<tr><td class="h">25</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;go( &#39;Controller::Auth&#39;, &#39;login&#39; );</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">27</td><td colspan="5"></td></tr><tr><td class="h">28</td><td><div class="c3">1</div></td><td><div class="c0" title="-/-"><a href="lib-LIMS2-WebApp-Controller-User-pm--branch.html#L28">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ! $c-&gt;session-&gt;{selected_species} ) {</td></tr>
<tr><td class="h">29</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $prefs = $c-&gt;model(&#39;Golgi&#39;)-&gt;retrieve_user_preferences( { id =&gt; $c-&gt;user-&gt;id } );</td></tr>
<tr><td class="h">30</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;session-&gt;{selected_species} = $prefs-&gt;default_species_id;</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">32</td><td colspan="5"></td></tr><tr><td class="h">33</td><td><div class="c3">1</div></td><td><div class="c0" title="-/-"><a href="lib-LIMS2-WebApp-Controller-User-pm--branch.html#L33">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ! $c-&gt;session-&gt;{species} ) {</td></tr>
<tr><td class="h">34</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;session-&gt;{species} = $c-&gt;model(&#39;Golgi&#39;)-&gt;list_species;</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">36</td><td colspan="5"></td></tr><tr><td class="h">37</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1;</td></tr>
<tr><td class="h">38</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L38">2</a></div></td><td class="s">}</td></tr>
<tr><td class="h">39</td><td colspan="5"></td></tr><tr><td class="h">40 - 48</td><td colspan="4"></td><td class="s"><pre>=head2 end

If we are runnning in production, we don&#39;t want to scare off the users
with the Catalyst error message. But in debug mode, we want the stack
trace in its full glory. This method runs at the end of a request and,
if we have errors and are not in debug mode, redirects to the index
with a simple error message.

=cut</pre></td></tr>
<tr><td class="h">49</td><td colspan="5"></td></tr><tr><td class="h">50</td><td></td><td></td><td></td><td></td><td class="s">sub end :Private {</td></tr>
<tr><td class="h">51</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L51">1</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $c ) = @_;</td></tr>
<tr><td class="h">52</td><td colspan="5"></td></tr><tr><td class="h">53</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @errors = @{ $c-&gt;error };</td></tr>
<tr><td class="h">54</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="lib-LIMS2-WebApp-Controller-User-pm--branch.html#L54">50</a></div></td><td><div class="c0"><a href="lib-LIMS2-WebApp-Controller-User-pm--condition.html#L54">33</a></div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( @errors &gt; 0 &amp;&amp; ! $c-&gt;debug ) {</td></tr>
<tr><td class="h">55</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;log-&gt;error( $_ ) for @errors;</td></tr>
<tr><td class="h">56</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;clear_errors;</td></tr>
<tr><td class="h">57</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;stash( errors =&gt; \@errors );</td></tr>
<tr><td class="h">58</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $c-&gt;go( &#39;error&#39; );</td></tr>
<tr><td class="h">59</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">60</td><td colspan="5"></td></tr><tr><td class="h">61</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $c-&gt;detach( &#39;Controller::Root&#39;, &#39;end&#39; );</td></tr>
<tr><td class="h">62</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L62">2</a></div></td><td class="s">}</td></tr>
<tr><td class="h">63</td><td colspan="5"></td></tr><tr><td class="h">64 - 66</td><td colspan="4"></td><td class="s"><pre>=head2 index

=cut</pre></td></tr>
<tr><td class="h">67</td><td colspan="5"></td></tr><tr><td class="h">68</td><td></td><td></td><td></td><td></td><td class="s">sub index :Path :Args(0) {</td></tr>
<tr><td class="h">69</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L69">1</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $c ) = @_;</td></tr>
<tr><td class="h">70</td><td colspan="5"></td></tr><tr><td class="h">71</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;assert_user_roles( &#39;read&#39; );</td></tr>
<tr><td class="h">72</td><td colspan="5"></td></tr><tr><td class="h">73</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">74</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L74">2</a></div></td><td class="s">}</td></tr>
<tr><td class="h">75</td><td colspan="5"></td></tr><tr><td class="h">76 - 78</td><td colspan="4"></td><td class="s"><pre>=head2 error

=cut</pre></td></tr>
<tr><td class="h">79</td><td colspan="5"></td></tr><tr><td class="h">80</td><td></td><td></td><td></td><td></td><td class="s">sub error :Local {</td></tr>
<tr><td class="h">81</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L81">0</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $c ) = @_;</td></tr>
<tr><td class="h">82</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;stash( template =&gt; &#39;user/error.tt&#39; );</td></tr>
<tr><td class="h">83</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">84</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L84">2</a></div></td><td class="s">}</td></tr>
<tr><td class="h">85</td><td colspan="5"></td></tr><tr><td class="h">86 - 88</td><td colspan="4"></td><td class="s"><pre>=head2 select_species

=cut</pre></td></tr>
<tr><td class="h">89</td><td colspan="5"></td></tr><tr><td class="h">90</td><td></td><td></td><td></td><td></td><td class="s">sub select_species :Local {</td></tr>
<tr><td class="h">91</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L91">0</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $c ) = @_;</td></tr>
<tr><td class="h">92</td><td colspan="5"></td></tr><tr><td class="h">93</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;assert_user_roles(&#39;read&#39;);</td></tr>
<tr><td class="h">94</td><td colspan="5"></td></tr><tr><td class="h">95</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $species_id = $c-&gt;request-&gt;param(&#39;species&#39;);</td></tr>
<tr><td class="h">96</td><td colspan="5"></td></tr><tr><td class="h">97</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;model(&#39;Golgi&#39;)-&gt;txn_do(</td></tr>
<tr><td class="h">98</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub {</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shift-&gt;set_user_preferences(</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">101</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L101">0</a></div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id              =&gt; $c-&gt;user-&gt;id,</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_species =&gt; $species_id</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">106</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">107</td><td colspan="5"></td></tr><tr><td class="h">108</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;session-&gt;{selected_species} = $species_id;</td></tr>
<tr><td class="h">109</td><td colspan="5"></td></tr><tr><td class="h">110</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$c-&gt;flash( info_msg =&gt; &quot;Switched to species $species_id&quot; );</td></tr>
<tr><td class="h">111</td><td colspan="5"></td></tr><tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $c-&gt;response-&gt;redirect( $c-&gt;uri_for(&#39;/&#39;) );</td></tr>
<tr><td class="h">113</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="lib-LIMS2-WebApp-Controller-User-pm--subroutine.html#L113">2</a></div></td><td class="s">}</td></tr>
<tr><td class="h">114</td><td colspan="5"></td></tr><tr><td class="h">115 - 124</td><td colspan="4"></td><td class="s"><pre>=head1 AUTHOR

Ray Miller

=head1 LICENSE

This library is free software. You can redistribute it and/or modify
it under the same terms as Perl itself.

=cut</pre></td></tr>
<tr><td class="h">125</td><td colspan="5"></td></tr><tr><td class="h">126</td><td></td><td></td><td></td><td></td><td class="s">__PACKAGE__-&gt;meta-&gt;make_immutable;</td></tr>
<tr><td class="h">127</td><td colspan="5"></td></tr><tr><td class="h">128</td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
